// This is a manifest file that'll be compiled into application.js, which will include all the files
// listed below.
//
// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,
// or any plugin's vendor/assets/javascripts directory can be referenced here using a relative path.
//
// It's not advisable to add code directly here, but if you do, it'll appear at the bottom of the
// compiled file.
//
// Read Sprockets README (https://github.com/rails/sprockets#sprockets-directives) for details
// about supported directives.
//
//= require jquery
//= require jquery_ujs
//= require foundation
//= require turbolinks
//= require ckeditor/init
//= require_tree .

var ready = function(){

  // Foundation options
  $(document).foundation({
    topbar: {
              sticky_class : 'sticky',
              custom_back_text: false, // Set this to false and it will pull the top level link name as the back text
              is_hover: true,
              mobile_show_parent_link: false, // will copy parent links into dropdowns for mobile navigation
              scrolltop : false // jump to top when sticky nav menu toggle is clicked
            },
    abide : {
      patterns: {
        advanced_email: /^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,
        length500: /^.{1,500}$/gm
      }
    }
  });

  // Image protection script
  $(function() {
      var pixelSource = "<%= asset_path('Transparent.gif') %>";
      var useOnAllImages = true;
      // Preload the pixel
      var preload = new Image();
      preload.src = pixelSource;
      $('.protect img').on('mouseenter touchstart', function(e) {
          // Only execute if this is not an overlay or skipped
          var img = $(this);
          if (img.hasClass('protectionOverlay')) return;
          if (!useOnAllImages && !img.hasClass('protectMe')) return;
          // Get the real image's position, add an overlay
          var pos = img.offset();
          var overlay = $('<img class="protectionOverlay" src="' + pixelSource + '" width="' + img.width() + '" height="' + img.height() + '" />').css({position: 'absolute', zIndex: 9999999, left: pos.left, top: pos.top}).appendTo('body').bind('mouseleave', function() {
              setTimeout(function(){ overlay.remove(); }, 0, $(this));
          });
          if ('ontouchstart' in window) $(document).one('touchend', function(){ setTimeout(function(){ overlay.remove(); }, 0, overlay); });
      });
  });

  //Owl Carousel
  // $(".owl-carousel").owlCarousel({
  //   // this options for owl-carousel 2.0 beta
  //   animateOut:   'fadeOut',
  //   itemsScaleUp: true,
  //   autoHeight:   true,
  //   loop:         true,
  //   autoplay:     true,
  //   items:        1
  // });

  function getWidthHeight(){
    if(window.innerWidth !== undefined && window.innerHeight !== undefined) {
      var w = window.innerWidth;
      var h = window.innerHeight;
    } else {
      var w = document.documentElement.clientWidth;
      var h = document.documentElement.clientHeight;
    }
    return [w, h]
  }

  $(".owl-wrapper-outer").css("height", getWidthHeight()[1]-45);


  //Slick
  $('.fade').slick({
    adaptiveHeight: true,
    autoplay:       true,
    autoplaySpeed:  3000,
    mobileFirst:    true,
    infinite:       true,
    speed:          700,
    fade:           true,
    arrows:         false,
    cssEase:        'linear'
  });

  $('.variable-width').slick({
    infinite:       true,
    speed:          300,
    centerMode:     true,
    arrows:         true,
    // variableWidth:  true,
    slidesToShow:   4,
    slidesToScroll: 4,
    responsive: [
      {
        breakpoint: 1024,
        settings: {
          slidesToShow: 3,
          slidesToScroll: 3
        }
      },
      {
        breakpoint: 600,
        settings: {
          slidesToShow: 2,
          slidesToScroll: 2
        }
      },
      {
        breakpoint: 480,
        settings: {
          slidesToShow: 1,
          slidesToScroll: 1
        }
      }
      // You can unslick at a given breakpoint now by adding:
      // settings: "unslick"
      // instead of a settings object
    ]
  });

  function sleep(milliseconds) {
    var start = new Date().getTime();
    for (var i = 0; i < 1e7; i++) {
      if ((new Date().getTime() - start) > milliseconds){
        break;
      }
    }
  }

  $('.variable-width .slick-prev').hover(
    function(){
        $('.variable-width').slick('slickPrev');
        sleep(1000);
    },
    function(){
      return
    }
  );

  //Photo Swipe
  // function buildPswdHtml(){
  //     $("body").append([
  //       '<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">',
  //       '    <div class="pswp__bg"></div>',
  //       '    <div class="pswp__scroll-wrap">',
  //       '        <div class="pswp__container">',
  //       '            <div class="pswp__item"></div>',
  //       '            <div class="pswp__item"></div>',
  //       '            <div class="pswp__item"></div>',
  //       '        </div>',
  //       '        <div class="pswp__ui pswp__ui--hidden">',
  //       '            <div class="pswp__top-bar">',
  //       '                <div class="pswp__counter"></div>',
  //       '                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>',
  //       '                <button class="pswp__button pswp__button--share" title="Share"></button>',
  //       '                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>',
  //       '                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>',
  //       '                <div class="pswp__preloader">',
  //       '                    <div class="pswp__preloader__icn">',
  //       '                      <div class="pswp__preloader__cut">',
  //       '                        <div class="pswp__preloader__donut"></div>',
  //       '                      </div>',
  //       '                    </div>',
  //       '                </div>',
  //       '            </div>',
  //       '            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">',
  //       '                <div class="pswp__share-tooltip"></div>',
  //       '            </div>',
  //       '            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">',
  //       '            </button>',
  //       '            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">',
  //       '            </button>',
  //       '            <div class="pswp__caption">',
  //       '                <div class="pswp__caption__center"></div>',
  //       '            </div>',
  //       '        </div>',
  //       '    </div>',
  //       '</div>'
  //   ]);
  // };
};

$(document).ready(ready)
$(document).on('page:change', ready)